<div class="container-fluid">
    <div class="card card-container">
        <div class="row mb-3">
            <h5 class="letra-morada mb-2 mt-2 fs-3">LISTA DE SOLICITUDES</h5>
            <hr>
        </div>
        <div class="row mb-5">
            <div class="col-md-6 mb-3">
              <app-filtros-tickets (filtrosAplicados)="aplicarFiltros($event)"></app-filtros-tickets>
            </div>
            <div class="col-md-6">
                <button class="btn btn-primary" (click)="crear()" style="width:100%">CREAR TICKET</button>
                <!--Aquí se llaman las ventanas emergentes-->
                <app-crud-tickets [crear_ticket]="crear_ticket" [idTicket]="id_ticket" [ventana_editarTicket]="ventana_editarTicket"
                    (ventanaEditCerrada)="CierreVentanaEdit()" (ventanaCrearCerrada)="CierreVentanaCrear()" [ventana_VerTicket]="ventana_verTicket" (ventanaVerCerrada)="CierreVentanaVer()">
                </app-crud-tickets>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div *ngIf="cantidad_tickets !== null && cantidad_tickets > 0; else sin_tickets">
            <div class="table-container">
                <table class="table tabla-tickets">
                <thead>
                  <tr>
                    <th class="encabezado-morado">Token</th>
                    <th class="encabezado-morado">Usuario</th>
                    <th class="encabezado-morado">Categoria</th>
                    <th class="encabezado-morado">Item</th>
                    <th class="encabezado-morado">Asunto</th>
                    <th class="encabezado-morado">Responsable</th>
                    <th class="encabezado-morado">Fecha Solicitud</th>
                    <th class="encabezado-morado">Fecha Límite de respuesta</th>
                    <th class="encabezado-morado">Estado</th>
                    <th class="encabezado-morado">Prioridad</th>
                    <th class="encabezado-morado">Opciones</th>
                    <th *ngIf="tipo_usuario=='administrador' ||permiso_usuario=='1'" class="encabezado-morado">Opciones de administrador</th>
                  </tr>
                </thead>
                <tbody>
                    <tr>
                  <!-- Aquí puedes utilizar *ngFor para iterar sobre los registros de tu base de datos -->
                  <tr *ngFor="let ticket of tickets; let i=index">
                    <td>{{ ticket.token }}</td>
                    <td>{{ usuariosID[i]}}</td>
                    <td>{{ categoriasID[i]}}</td>
                    <td>{{ itemsID[i]}}</td>
                    <td>{{ ticket.asunto}}</td>
                    <td>{{ responsablesID[i] }}</td>
                    <td><input type="date" class="fecha" disabled="true"  [value]="ticket.fecha_solicitud ? ticket.fecha_solicitud.toISOString().substring(0, 10) : ''" /></td>
                    <td>
                      <ng-container *ngIf="ticket.fecha_limite; else noFechaLimite">
                        <input type="date" [value]="ticket.fecha_limite.toISOString().substring(0, 10)" class="fecha" disabled="true"/>
                      </ng-container>
                      <ng-template #noFechaLimite>
                        Seleccione primero la prioridad
                      </ng-template>
                    </td>
                    <td><span style="font-weight:bold;">{{ estadosID[i] }}</span><br/>

                      <img *ngIf="estadosID[i]=='Pendiente'" src="../../../assets/images/reloj.png" class="img-fluid" style="max-width: 40px;">
                      <img *ngIf="estadosID[i]=='En proceso'" src="../../../assets/images/trabajo-en-progreso.png" class="img-fluid" style="max-width: 40px;">
                      <img *ngIf="estadosID[i]=='Completada'" src="../../../assets/images/correcto.png" class="img-fluid" style="max-width: 40px;">
                    </td>
                    <td>
                      <span style="font-weight:bold;">{{ prioridadesID[i]}}</span><br/>
                      <img *ngIf="prioridadesID[i]=='Baja'" src="../../../assets/images/relajarse.png" class="img-fluid" style="max-width: 40px;">
                      <img *ngIf="prioridadesID[i]=='Media'" src="../../../assets/images/advertencia.png" class="img-fluid" style="max-width: 40px;">
                      <img *ngIf="prioridadesID[i]=='Alta'" src="../../../assets/images/alerta.png" class="img-fluid" style="max-width: 40px;">
                    </td>
                    <td><button class="btn btn-primary" (click)="ver_ticket(ticket.token)">Ver detalles</button></td>
                    <td *ngIf="tipo_usuario=='administrador' ||permiso_usuario=='1'">
                      <div class="row">
                        <div class="col">
                          <button class="btn opciones-admin" (click)="editar_ticket(ticket.token)">Editar</button>
                          <button class="btn opciones-admin">Eliminar</button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table> 
            </div>
            </div>
            <ng-template #sin_tickets>
              <div class="col d-flex flex-column align-items-center justify-content-center text-center">
                <h5 class="sin_tickets mt-2">En la actualidad no tiene ningún Ticket registrado</h5>
                <img src="../../../assets/images/advertencia.png" alt="Advertencia" class="img-fluid" style="max-width: 150px;">
              </div>
            </ng-template>
        </div>
    </div>
</div>
  
